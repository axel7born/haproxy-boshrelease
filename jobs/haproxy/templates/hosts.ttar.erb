<%-
require 'yaml'
require "base64"
require 'zlib'
require 'stringio'
require 'tempfile'


if_p('ha_proxy.hosts_in_file') do |files|
  if !(files.is_a?(Array)) then
    gzplain = Base64.decode64(files)
    gz = Zlib::GzipReader.new(StringIO.new(gzplain))
    temp = Tempfile.new('hosts')
    temp.write(gz.read)
    temp.read
    files = YAML.load(File.read(temp))
    temp.close
    temp.unlink
end
  files.each do |file|
    name = file["name"]
    content = ""
    file['hosts'].each do |host|
      content << host.strip + "\n"
    end
-%>
========================== 0600 /var/vcap/jobs/haproxy/config/hosts/<%= name %>
# generated by hosts.ttar.erb
<%= content %>
<%-
  end
end -%>
