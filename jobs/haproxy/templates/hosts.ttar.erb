<%-
require "base64"
require 'zlib'
require 'stringio'

if_p('ha_proxy.hosts_in_file') do |files|
  if !(files.is_a?(Array)) then
    gzplain = Base64.decode64(files)
    gz = Zlib::GzipReader.new(StringIO.new(gzplain))
    files = gz.read
  files.each do |file|
  name = file["name"]
  content = ""
  file['hosts'].each do |host|
  content << host.strip + "\n"
  end
  end
-%>
========================== 0600 /var/vcap/jobs/haproxy/config/hosts/<%= name %>
# generated by hosts.ttar.erb
<%= content %>
<%-
  end
end -%>
