<%-
require "base64"
require 'zlib'
require 'stringio'
require 'yaml'

if_p('ha_proxy.hosts_in_file') do |files|
  files.each do |file|

    gzplain = Base64.decode64(file)
    gz = Zlib::GzipReader.new(StringIO.new(gzplain))
    file = gz.read
    name = YAML.load(file)["name"]
    name = "allow_hosts"
    hosts = YAML.load(file)["hosts"]
    content = ""
    hosts.each do |host|
      content << host.strip + "\n"
    end
-%>
========================== 0600 /var/vcap/jobs/haproxy/config/hosts/<%= name %>
# generated by hosts.ttar.erb
<%= content %>
<%-
  end
end -%>
